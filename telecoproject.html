<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teleco Project</title>
<style>
  :root{
    /* Paleta base (oscuro por defecto, respeta tu estilo) */
    --bg:#0f172a;          /* fondo */
    --panel:#111827;       /* tarjetas */
    --accent:#22c55e;      /* verde */
    --accent-2:#60a5fa;    /* azul */
    --text:#e5e7eb;        /* texto */
    --muted:#94a3b8;       /* texto suave */
    --danger:#ef4444;      /* rojo error */
    --ok:#10b981;          /* verde ok */
    --radius:18px;

    /* Light mode (se activa con .light en <body>) */
    --bg-light:#f7fafc;
    --panel-light:#ffffff;
    --text-light:#0f172a;
    --muted-light:#4b5563;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; 
    background: radial-gradient(1200px 600px at 50% -10%, #1f2937, var(--bg));
    color:var(--text);
    transition: background .25s ease, color .25s ease;
  }
  body.light{
    background: radial-gradient(1200px 600px at 50% -10%, #e5e7eb, var(--bg-light));
    color:var(--text-light);
  }
  header{
    position:sticky; top:0; z-index:10;
    background:rgba(17,24,39,.75);
    backdrop-filter: blur(8px);
    border-bottom:1px solid rgba(255,255,255,.06);
    transition: background .25s ease, border-color .25s ease;
  }
  body.light header{
    background:rgba(255,255,255,.8);
    border-bottom-color: rgba(0,0,0,.08);
  }
  .wrap{max-width:1000px;margin:0 auto;padding:18px}
  .title{
    display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.5px;
    font-size:clamp(22px, 2.2vw, 28px);
  }
  .title .dot{width:12px;height:12px;background:conic-gradient(from 0deg, var(--accent), var(--accent-2));
    border-radius:50%; box-shadow:0 0 24px rgba(96,165,250,.6)}
  .grid{
    display:grid; gap:16px; margin-top:18px;
    grid-template-columns: repeat( auto-fill, minmax(240px, 1fr) );
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius); padding:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.25);
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .25s ease, border-color .25s ease;
  }
  .card:hover{ transform:translateY(-2px); border-color: rgba(96,165,250,.45); box-shadow:0 12px 30px rgba(37,99,235,.20)}
  body.light .card{
    background:linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,.01));
    border-color: rgba(0,0,0,.08);
    box-shadow:0 8px 20px rgba(0,0,0,.08);
  }
  .btn{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(34,197,94,.25), rgba(34,197,94,.18));
    color:white; font-weight:700; letter-spacing:.2px;
    transition: transform .08s ease, filter .2s ease, background .2s ease, border-color .25s ease, color .25s ease;
    cursor:pointer;
  }
  .btn:hover{ filter:brightness(1.08) }
  .btn:active{ transform:scale(.98) }
  .btn-secondary{
    background:linear-gradient(180deg, rgba(96,165,250,.25), rgba(96,165,250,.18));
  }
  .btn-ghost{
    background:transparent; border:1px dashed rgba(255,255,255,.18); color:var(--muted)
  }
  body.light .btn-ghost{ border-color: rgba(0,0,0,.15); color:var(--muted-light) }
  .btn-inline{ width:auto; padding:8px 12px; border-radius:10px }
  .section{ display:none; animation:fade .2s ease }
  .section.active{ display:block }
  @keyframes fade{ from{opacity:0; transform: translateY(4px)} to{opacity:1; transform:none}}
  .h2{font-size:clamp(18px, 2vw, 20px);font-weight:800;margin:8px 0 10px}
  .muted{color:var(--muted); font-size:13px}
  body.light .muted{ color:var(--muted-light) }
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .field{flex:1; min-width:140px}
  label.tag{ display:block; font-size:11px; color:var(--muted); margin-bottom:4px }
  input, select, textarea{
    width:100%; padding:12px 10px; background:#0b1020; color:var(--text);
    border:1px solid rgba(255,255,255,.12); border-radius:12px;
    outline:none; transition:border-color .15s ease, box-shadow .15s ease, background .25s ease, color .25s ease;
    text-align:center;
  }
  textarea{ text-align:left; min-height:80px; resize:vertical }
  input:focus, select:focus, textarea:focus{border-color:#60a5fa; box-shadow:0 0 0 4px rgba(96,165,250,.15)}
  body.light input, body.light select, body.light textarea{
    background:#ffffff; color:var(--text-light); border-color: rgba(0,0,0,.12)
  }
  .pill{
    display:inline-flex; gap:8px; align-items:center;
    padding:6px 10px; font-size:12px; border-radius:999px;
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08)
  }
  body.light .pill{ background:rgba(0,0,0,.04); border-color: rgba(0,0,0,.08) }
  .tag{ font-size:11px; color:var(--muted)}
  .error{ color:var(--danger); font-weight:700; margin-top:6px}
  .ok{ color:var(--ok); font-weight:700; margin-top:6px}
  .result{
    margin-top:12px; padding:12px; border-radius:12px;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
    text-align:left; line-height:1.5; animation:fade .3s ease; overflow:auto
  }
  body.light .result{ background:rgba(0,0,0,.04); border-color: rgba(0,0,0,.08) }
  .ip-slots{ display:flex; gap:10px; justify-content:center; margin:8px 0; flex-wrap:wrap }
  .oct{ width:72px }
  @media (max-width:480px){ .oct{width:64px} }
  .chip{
    display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px;
    background:rgba(96,165,250,.15); border:1px solid rgba(96,165,250,.35); margin-right:6px
  }
  .footer{ text-align:center; color:var(--muted); font-size:12px; padding:22px 0 36px }
  .back{ margin-top:10px }
  .divider{ height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent); margin:14px 0 }
  body.light .divider{ background: linear-gradient(90deg, transparent, rgba(0,0,0,.12), transparent) }
  .list{margin:0; padding-left:16px}
  .list li{ margin:4px 0}

  table{width:100%; border-collapse:collapse; margin-top:8px; font-size:13px; min-width:560px}
  th, td{padding:6px 8px; border:1px solid rgba(255,255,255,.1); text-align:center}
  th{background:rgba(255,255,255,.05)}
  body.light th, body.light td{ border-color: rgba(0,0,0,.12) }
  body.light th{ background: rgba(0,0,0,.04) }

  /* Toggle tema */
  .theme-toggle{
    position:fixed; right:16px; bottom:16px; z-index:20;
    border-radius:999px; padding:10px 14px;
    background:linear-gradient(180deg, rgba(96,165,250,.3), rgba(34,197,94,.25));
    border:1px solid rgba(255,255,255,.12); color:#fff; cursor:pointer; font-weight:800;
    box-shadow:0 8px 24px rgba(0,0,0,.3)
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <span class="dot"></span> Teleco Project
      <span class="muted" style="font-weight:600">‚Ä¢ Herramientas r√°pidas</span>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- MENU -->
  <section id="menu" class="section active">
    <div class="grid">
      <div class="card">
        <div class="h2">Conversores</div>
        <div class="muted">Bases, IP y dB (todo en uno)</div>
        <div class="divider"></div>
        <button class="btn" onclick="openSection('conv')">Abrir</button>
      </div>
      <div class="card">
        <div class="h2">VLSM</div>
        <div class="muted">Asigna subredes por requerimientos</div>
        <div class="divider"></div>
        <button class="btn btn-secondary" onclick="openSection('vlsm')">Abrir</button>
      </div>
      <div class="card">
        <div class="h2">Tablas r√°pidas</div>
        <div class="muted">CIDR, m√°scaras y rangos privados</div>
        <div class="divider"></div>
        <button class="btn btn-ghost" onclick="openSection('tablas')">Abrir</button>
      </div>
    </div>
  </section>

  <!-- CONVERSORES -->
  <section id="conv" class="section">
    <div class="card">
      <div class="h2">Conversores</div>
      <div class="muted">Elige una herramienta abajo. Todo es responsive.</div>
      <div class="divider"></div>

      <div class="grid">
        <!-- Bases -->
        <div class="card">
          <div class="h2">Bases: Bin ‚áÑ Dec ‚áÑ Hex</div>
          <div class="muted">Convierte uno o varios valores. Usa ‚Äúmodo lista‚Äù para tabla.</div>
          <div class="row">
            <div class="field">
              <label class="tag">N√∫mero(s)</label>
              <textarea id="conv-num" placeholder="Ej: 101101, 45, 2A&#10;(separados por coma o salto de l√≠nea)"></textarea>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label class="tag">De</label>
              <select id="conv-from">
                <option value="bin">Binario</option>
                <option value="dec" selected>Decimal</option>
                <option value="hex">Hexadecimal</option>
              </select>
            </div>
            <div class="field">
              <label class="tag">A</label>
              <select id="conv-to">
                <option value="bin">Binario</option>
                <option value="dec">Decimal</option>
                <option value="hex" selected>Hexadecimal</option>
              </select>
            </div>
            <div class="field" style="min-width:120px; display:flex; align-items:flex-end; gap:8px">
              <button class="btn btn-secondary" onclick="swapBases()">‚áÑ Invertir</button>
            </div>
          </div>
          <div class="row">
            <label class="pill"><input type="checkbox" id="bases-list" style="accent-color:#60a5fa"> Modo lista (tabla)</label>
          </div>
          <button class="btn" onclick="convertBases()">Convertir</button>
          <div id="conv-msg" class="error" style="display:none"></div>
          <div id="conv-res" class="result" style="display:none"></div>
        </div>

        <!-- IP Binaria ‚áÑ Decimal -->
        <div class="card">
          <div class="h2">IP: Binario ‚áÑ Decimal</div>
          <div class="muted">Octetos separados, m√°ximo 3 d√≠gitos (0‚Äì255).</div>

          <div class="row" style="align-items:flex-end">
            <div class="field">
              <label class="tag">Binario ‚Üí Decimal</label>
              <div class="ip-slots">
                <input class="oct" id="b1" maxlength="8" placeholder="00000000" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="b2" maxlength="8" placeholder="00000000" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="b3" maxlength="8" placeholder="00000000" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="b4" maxlength="8" placeholder="00000000" inputmode="numeric" />
              </div>
              <button class="btn btn-secondary" onclick="ipBinToDec()">Convertir</button>
              <div id="bin2dec-msg" class="error" style="display:none"></div>
              <div id="bin2dec-res" class="result" style="display:none"></div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row" style="align-items:flex-end">
            <div class="field">
              <label class="tag">Decimal ‚Üí Binario</label>
              <div class="ip-slots">
                <input class="oct" id="d1" maxlength="3" placeholder="192" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="d2" maxlength="3" placeholder="168" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="d3" maxlength="3" placeholder="1" inputmode="numeric" />
                <span class="pill">.</span>
                <input class="oct" id="d4" maxlength="3" placeholder="10" inputmode="numeric" />
              </div>
              <div class="row" style="gap:8px; align-items:center">
                <button class="btn btn-secondary" onclick="ipDecToBin()">Convertir</button>
                <button class="btn btn-ghost btn-inline" onclick="swapIPFields()">‚áÑ Invertir campos</button>
              </div>
              <div id="dec2bin-msg" class="error" style="display:none"></div>
              <div id="dec2bin-res" class="result" style="display:none"></div>
            </div>
          </div>
        </div>

        <!-- Potencia/Voltaje ‚áÑ dB -->
        <div class="card">
          <div class="h2">Potencia / Voltaje ‚áÑ dB</div>
          <div class="muted">dBW, dBm, dBV, dBmV. Selecciona fuente y opcionalmente Z (Œ©).</div>

          <div class="row">
            <div class="field">
              <label class="tag">Tipo de entrada</label>
              <select id="db-mode">
                <option value="power">Potencia (W)</option>
                <option value="voltage">Voltaje (V)</option>
                <option value="dbw">dBW</option>
                <option value="dbm">dBm</option>
                <option value="dbv">dBV</option>
                <option value="dbmv">dBmV</option>
              </select>
            </div>
            <div class="field">
              <label class="tag">Valor</label>
              <input id="db-input" placeholder="Ej: 0.5" inputmode="decimal">
            </div>
            <div class="field">
              <label class="tag">Impedancia Z (Œ©)</label>
              <input id="db-z" placeholder="50" inputmode="decimal" value="50">
            </div>
            <div class="field" style="min-width:120px; display:flex; align-items:flex-end">
              <button class="btn btn-secondary" onclick="calcDB()">Calcular</button>
            </div>
          </div>

          <div class="row" style="gap:8px">
            <button class="btn btn-ghost btn-inline" onclick="quickSet('power',1)">P=1 W</button>
            <button class="btn btn-ghost btn-inline" onclick="quickSet('voltage',1)">V=1 V</button>
            <button class="btn btn-ghost btn-inline" onclick="quickSet('dbm',0)">0 dBm</button>
            <button class="btn btn-ghost btn-inline" onclick="quickSet('dbv',0)">0 dBV</button>
          </div>

          <div id="db-msg" class="error" style="display:none"></div>
          <div id="db-res" class="result" style="display:none"></div>
        </div>
      </div>

      <div class="back">
        <button class="btn btn-ghost" onclick="openSection('menu')">‚¨Ö Volver</button>
      </div>
    </div>
  </section>

  <!-- VLSM -->
  <section id="vlsm" class="section">
    <div class="card">
      <div class="h2">Calculadora VLSM</div>
      <div class="muted">Define red base y requerimientos. Se asigna de mayor a menor (opcional).</div>
      <div class="divider"></div>

      <div class="row">
        <div class="field">
          <label class="tag">Red base (IPv4)</label>
          <input id="vlsm-base" placeholder="Ej: 10.0.0.0" />
        </div>
        <div class="field">
          <label class="tag">Prefijo</label>
          <input id="vlsm-prefix" placeholder="/8, /16, /24" />
        </div>
      </div>

      <div class="divider"></div>
      <div class="h2">Requerimientos de Subred</div>
      <div class="row" style="gap:8px; align-items:center">
        <div class="field"><input id="req-name" placeholder="Nombre (ej: Sede A)" /></div>
        <div class="field"><input id="req-hosts" inputmode="numeric" placeholder="Hosts (ej: 50)" /></div>
        <div class="field" style="min-width:140px">
          <button class="btn" onclick="addRequirement()">+ Agregar</button>
        </div>
      </div>

      <div class="row" style="gap:10px; align-items:center; margin-top:6px">
        <label class="pill"><input type="checkbox" id="vlsm-sort" checked style="accent-color:#60a5fa"> Ordenar de mayor a menor</label>
        <button class="btn btn-ghost btn-inline" onclick="clearReqs()">Limpiar</button>
        <button class="btn btn-ghost btn-inline" onclick="loadSampleReqs()">Ejemplo</button>
      </div>

      <div id="req-list"></div>

      <div class="divider"></div>
      <div class="row" style="gap:8px">
        <button class="btn btn-secondary" onclick="runVLSM()">Calcular VLSM</button>
        <button class="btn btn-ghost btn-inline" onclick="copyElem('vlsm-res')">üìã Copiar</button>
        <button class="btn btn-ghost btn-inline" onclick="exportCSV()">‚¨á CSV</button>
      </div>
      <div id="vlsm-msg" class="error" style="display:none"></div>
      <div id="vlsm-res" class="result" style="display:none"></div>

      <div class="back">
        <button class="btn btn-ghost" onclick="openSection('menu')">‚¨Ö Volver</button>
      </div>
    </div>
  </section>

  <!-- TABLAS R√ÅPIDAS -->
  <section id="tablas" class="section">
    <div class="card">
      <div class="h2">Tablas r√°pidas</div>
      <div class="divider"></div>
      <ul class="list">
        <li><span class="chip">Privadas</span> 10.0.0.0/8 ‚Äî 172.16.0.0/12 ‚Äî 192.168.0.0/16</li>
        <li><span class="chip">M√°scaras comunes</span> /24 = 255.255.255.0 ‚Äî /26 = 255.255.255.192 ‚Äî /30 = 255.255.255.252</li>
        <li><span class="chip">Potencias de 2</span> 2, 4, 8, 16, 32, 64, 128, 256‚Ä¶</li>
        <li><span class="chip">Clases hist√≥ricas</span> A (1.0.0.0/8) ‚Äî B (128.0.0.0/16) ‚Äî C (192.0.0.0/24)</li>
      </ul>
      <div class="back">
        <button class="btn btn-ghost" onclick="openSection('menu')">‚¨Ö Volver</button>
      </div>
    </div>
  </section>

  <div class="footer">¬© 2025 ‚Ä¢ Teleco Project</div>
</main>

<button class="theme-toggle" onclick="toggleTheme()">üåì Tema</button>

<script>
  /* Navegaci√≥n simple */
  function openSection(id){
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo({top:0, behavior:'smooth'});
  }

  /* Tema */
  (function initTheme(){
    const saved = localStorage.getItem('teleco-theme');
    if(saved === 'light') document.body.classList.add('light');
  })();
  function toggleTheme(){
    document.body.classList.toggle('light');
    localStorage.setItem('teleco-theme', document.body.classList.contains('light')?'light':'dark');
  }

  /* Helpers UI */
  function showErr(el, text){ el.textContent = text; el.style.display='block'; el.className='error'; }
  function showOk(el, html){ el.innerHTML = html; el.style.display='block'; el.className='ok'; }
  function escapeHtml(str){ return str.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function copyElem(id){
    const el = document.getElementById(id);
    if(!el) return;
    const txt = el.innerText;
    navigator.clipboard.writeText(txt).then(()=>{
      const old = el.dataset.copied;
      el.dataset.copied = 'true';
      setTimeout(()=>{ el.dataset.copied = old || ''; }, 1200);
    });
  }

  /* Conversor de bases */
  function swapBases(){
    const a = document.getElementById('conv-from');
    const b = document.getElementById('conv-to');
    const tmp = a.value; a.value = b.value; b.value = tmp;
  }
  function labelBase(b){ return b==='bin'?'Binario':b==='dec'?'Decimal':'Hexadecimal'; }
  function parseByBase(str, base){
    if(base==='bin') return /^[01]+$/i.test(str) ? parseInt(str,2) : NaN;
    if(base==='dec') return /^\d+$/i.test(str) ? parseInt(str,10) : NaN;
    return /^[0-9a-f]+$/i.test(str) ? parseInt(str,16) : NaN;
  }
  function formatByBase(n, base){
    if(base==='bin') return n.toString(2);
    if(base==='dec') return n.toString(10);
    return n.toString(16).toUpperCase();
  }
  function convertBases(){
    const numStr = document.getElementById('conv-num').value.trim();
    const from = document.getElementById('conv-from').value;
    const to = document.getElementById('conv-to').value;
    const listMode = document.getElementById('bases-list').checked;
    const msg = document.getElementById('conv-msg');
    const res = document.getElementById('conv-res');
    msg.style.display='none'; res.style.display='none';
    if(!numStr){ showErr(msg, 'Ingresa al menos un valor.'); return; }

    const items = listMode ? numStr.split(/[\s,;]+/).filter(Boolean) : [numStr];
    const rows = [];
    for(const it of items){
      const val = parseByBase(it, from);
      if(Number.isNaN(val)){ showErr(msg, `Formato inv√°lido para ${labelBase(from)}: ${escapeHtml(it)}`); return; }
      const out = formatByBase(val, to);
      rows.push({in:it, out});
    }
    if(listMode){
      res.innerHTML = `<table>
        <tr><th>Entrada (${labelBase(from)})</th><th>Salida (${labelBase(to)})</th></tr>
        ${rows.map(r=>`<tr><td>${escapeHtml(r.in)}</td><td><b>${escapeHtml(r.out)}</b></td></tr>`).join('')}
      </table>`;
    }else{
      res.innerHTML = `<b>${escapeHtml(items[0])}</b> (${labelBase(from)}) ‚Üí <b>${labelBase(to)}</b> = <b>${escapeHtml(rows[0].out)}</b>`;
    }
    res.style.display='block';
  }

  /* IP Binario ‚Üí Decimal (validaci√≥n estricta) */
  ['b1','b2','b3','b4'].forEach(id=>{
    const el = document.getElementById(id);
    el && el.addEventListener('input', (e)=>{
      e.target.value = e.target.value.replace(/[^01]/g,'').slice(0,8);
    });
  });
  function ipBinToDec(){
    const msg = document.getElementById('bin2dec-msg');
    const res = document.getElementById('bin2dec-res');
    msg.style.display='none'; res.style.display='none';
    const vals = ['b1','b2','b3','b4'].map(id=>document.getElementById(id).value.trim());
    if(vals.some(v => v.length!==8)){ showErr(msg,'Cada octeto debe tener exactamente 8 bits.'); return; }
    if(vals.some(v => /[^01]/.test(v))){ showErr(msg,'Solo se permiten 0 y 1.'); return; }
    const decs = vals.map(v=> parseInt(v,2));
    const dotted = decs.join('.');
    res.innerHTML = `<div><span class="chip">${vals.join('.')}</span> ‚Üí <b>${dotted}</b></div>`;
    res.style.display='block';
  }

  /* IP Decimal ‚Üí Binario (validaci√≥n estricta) */
  ['d1','d2','d3','d4'].forEach(id=>{
    const el = document.getElementById(id);
    el && el.addEventListener('input', (e)=>{
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,3);
    });
  });
  function ipDecToBin(){
    const msg = document.getElementById('dec2bin-msg');
    const res = document.getElementById('dec2bin-res');
    msg.style.display='none'; res.style.display='none';
    const raw = ['d1','d2','d3','d4'].map(id=>document.getElementById(id).value.trim());
    if(raw.some(v=>v==='')){ showErr(msg,'Completa los 4 octetos.'); return; }
    const nums = raw.map(v=>Number(v));
    if(nums.some(n=>Number.isNaN(n))){ showErr(msg,'Solo se permiten n√∫meros.'); return; }
    const invalid = nums.find(n => n<0 || n>255);
    if(invalid !== undefined){ showErr(msg, `Octeto fuera de rango: ${invalid}. M√°ximo 255.`); return; }
    const bins = nums.map(n=> n.toString(2).padStart(8,'0'));
    res.innerHTML = `<div><span class="chip">${nums.join('.')}</span> ‚Üí <b>${bins.join('.')}</b></div>`;
    res.style.display='block';
  }
  function swapIPFields(){
    // Intercambia los campos b* con d* cuando es posible
    const b = ['b1','b2','b3','b4'].map(id=>document.getElementById(id).value.trim());
    const d = ['d1','d2','d3','d4'].map(id=>document.getElementById(id).value.trim());
    // Si hay binario v√°lido, p√°salo a decimal inputs; si no, al rev√©s si d es v√°lido
    const binOk = b.every(v=>v.length===8 && /^[01]+$/.test(v));
    const decOk = d.every(v=>v!=='' && /^\d{1,3}$/.test(v) && Number(v)>=0 && Number(v)<=255);
    if(binOk){
      const decs = b.map(v=>parseInt(v,2));
      ['d1','d2','d3','d4'].forEach((id,i)=>document.getElementById(id).value = String(decs[i]));
    }else if(decOk){
      const bins = d.map(v=>Number(v).toString(2).padStart(8,'0'));
      ['b1','b2','b3','b4'].forEach((id,i)=>document.getElementById(id).value = bins[i]);
    }
  }

  /* dB Calculator */
  function quickSet(mode,val){
    document.getElementById('db-mode').value = mode;
    document.getElementById('db-input').value = val;
    if(mode==='voltage') document.getElementById('db-z').value = '50';
    calcDB();
  }
  function calcDB(){
    const mode = document.getElementById('db-mode').value;
    const v = Number(document.getElementById('db-input').value.trim());
    const Z = Number(document.getElementById('db-z').value.trim() || '50');
    const msg = document.getElementById('db-msg');
    const out = document.getElementById('db-res');
    msg.style.display='none'; out.style.display='none';

    if(Number.isNaN(v)){ showErr(msg,'Ingresa un valor num√©rico.'); return; }
    if(['voltage','power'].includes(mode) && (Number.isNaN(Z) || Z<=0)){ showErr(msg,'Impedancia Z debe ser > 0.'); return; }

    // Resultados: P[W], V[V], dBW, dBm, dBV, dBmV
    let P=null, V=null, dBW=null, dBm=null, dBV=null, dBmV=null;

    try{
      if(mode==='power'){
        P = v;
        if(P<=0) throw 'La potencia debe ser > 0.';
        dBW = 10*Math.log10(P);
        dBm = dBW + 30;
        V = Math.sqrt(P*Z);
        dBV = 20*Math.log10(V/1);
        dBmV = 20*Math.log10(V/0.001);
      }else if(mode==='voltage'){
        V = v;
        if(V<=0) throw 'El voltaje debe ser > 0.';
        P = (V*V)/Z;
        dBW = 10*Math.log10(P);
        dBm = dBW + 30;
        dBV = 20*Math.log10(V/1);
        dBmV = 20*Math.log10(V/0.001);
      }else if(mode==='dbw'){
        dBW = v;
        dBm = dBW + 30;
        P = Math.pow(10, dBW/10);
        V = Math.sqrt(P*Z);
        dBV = 20*Math.log10(V/1);
        dBmV = 20*Math.log10(V/0.001);
      }else if(mode==='dbm'){
        dBm = v;
        dBW = dBm - 30;
        P = Math.pow(10, dBW/10);
        V = Math.sqrt(P*Z);
        dBV = 20*Math.log10(V/1);
        dBmV = 20*Math.log10(V/0.001);
      }else if(mode==='dbv'){
        dBV = v;
        V = Math.pow(10, dBV/20)*1;
        P = (V*V)/Z;
        dBW = 10*Math.log10(P);
        dBm = dBW + 30;
        dBmV = 20*Math.log10(V/0.001);
      }else if(mode==='dbmv'){
        dBmV = v;
        V = Math.pow(10, dBmV/20)*0.001;
        P = (V*V)/Z;
        dBW = 10*Math.log10(P);
        dBm = dBW + 30;
        dBV = 20*Math.log10(V/1);
      }

      const fmt = (x, d=6)=> (Number.isFinite(x)? (Math.abs(x)<1e-6? x.toExponential(3): x.toFixed(d)) : '‚Äî');

      out.innerHTML = `
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <span class="pill"><b>P</b> = ${fmt(P,6)} W</span>
          <span class="pill"><b>V</b> = ${fmt(V,6)} V</span>
          <span class="pill"><b>dBW</b> = ${fmt(dBW,3)}</span>
          <span class="pill"><b>dBm</b> = ${fmt(dBm,3)}</span>
          <span class="pill"><b>dBV</b> = ${fmt(dBV,3)}</span>
          <span class="pill"><b>dBmV</b> = ${fmt(dBmV,3)}</span>
          <span class="pill"><b>Z</b> = ${fmt(Z,3)} Œ©</span>
        </div>
      `;
      out.style.display='block';
    }catch(e){
      showErr(msg, typeof e==='string'? e : 'Error en el c√°lculo.');
    }
  }

  /* VLSM */
  const reqs = JSON.parse(localStorage.getItem("teleco-reqs")||"[]");
  renderReqs();

  function addRequirement(){
    const name = document.getElementById('req-name').value.trim() || `Subred ${reqs.length+1}`;
    const hostsStr = document.getElementById('req-hosts').value.trim();
    const msg = document.getElementById('vlsm-msg');
    msg.style.display='none';

    if(!hostsStr){ showErr(msg,'Ingresa cantidad de hosts.'); return; }
    const hosts = Number(hostsStr);
    if(!Number.isInteger(hosts) || hosts<=0){ showErr(msg,'Hosts debe ser un entero positivo.'); return; }

    reqs.push({name, hosts});
    saveReqs(); clearReqInputs(); renderReqs();
  }
  function clearReqInputs(){
    document.getElementById('req-name').value='';
    document.getElementById('req-hosts').value='';
  }
  function saveReqs(){ localStorage.setItem("teleco-reqs", JSON.stringify(reqs)); }
  function renderReqs(){
    const cont = document.getElementById('req-list');
    cont.innerHTML = '';
    if(reqs.length===0){
      cont.innerHTML = `<div class="muted">(sin requerimientos)</div>`;
      return;
    }
    reqs.forEach((r, i)=>{
      const row = document.createElement('div');
      row.className='row';
      row.style.margin='6px 0';
      row.innerHTML = `
        <div class="pill" style="flex:1;justify-content:space-between; gap:12px">
          <span style="display:flex; gap:8px; align-items:center">
            <input class="btn-ghost" style="min-width:180px; padding:6px 10px; text-align:left; border-radius:10px"
              value="${escapeHtml(r.name)}" oninput="reqs[${i}].name=this.value; saveReqs();">
            <input class="btn-ghost" style="width:110px; padding:6px 10px; text-align:center; border-radius:10px"
              value="${r.hosts}" inputmode="numeric"
              oninput="this.value=this.value.replace(/\\D/g,''); reqs[${i}].hosts=Number(this.value||0); saveReqs();">
            <span class="tag">hosts</span>
          </span>
          <span style="display:flex; gap:6px">
            <button class="btn btn-ghost btn-inline" onclick="moveReq(${i},-1)">‚¨Ü</button>
            <button class="btn btn-ghost btn-inline" onclick="moveReq(${i},1)">‚¨á</button>
            <button class="btn btn-ghost btn-inline" onclick="delReq(${i})">‚úñ</button>
          </span>
        </div>
      `;
      cont.appendChild(row);
    });
  }
  function moveReq(i, dir){
    const j = i + dir;
    if(j<0 || j>=reqs.length) return;
    const tmp = reqs[i]; reqs[i] = reqs[j]; reqs[j] = tmp;
    saveReqs(); renderReqs();
  }
  function delReq(i){ reqs.splice(i,1); saveReqs(); renderReqs(); }
  function clearReqs(){ reqs.splice(0, reqs.length); saveReqs(); renderReqs(); }
  function loadSampleReqs(){
    reqs.splice(0, reqs.length, {name:'Sede A', hosts:60}, {name:'Sede B', hosts:28}, {name:'Enlace', hosts:2});
    saveReqs(); renderReqs();
  }

  function runVLSM(){
    const base = document.getElementById('vlsm-base').value.trim();
    const prefixStr = document.getElementById('vlsm-prefix').value.trim().replace('/','');
    const msg = document.getElementById('vlsm-msg');
    const out = document.getElementById('vlsm-res');
    const sort = document.getElementById('vlsm-sort').checked;
    msg.style.display='none'; out.style.display='none';

    // Validar IP base
    const ipParts = base.split('.');
    if(ipParts.length!==4 || ipParts.some(p=>p==='' || /\D/.test(p) || Number(p)<0 || Number(p)>255)){
      showErr(msg,'IP base inv√°lida. Usa formato x.x.x.x con octetos 0‚Äì255.'); return;
    }
    // Validar prefijo
    const pref = Number(prefixStr);
    if(!Number.isInteger(pref) || pref<0 || pref>32){
      showErr(msg,'Prefijo inv√°lido. Ej: /24'); return;
    }
    if(reqs.length===0){ showErr(msg,'Agrega al menos un requerimiento de hosts.'); return; }

    try{
      const baseNum = ipToNum(ipParts.map(Number));
      const blockSize = 2**(32-pref);
      const networkStart = baseNum & (~(blockSize-1));
      const sorted = sort? [...reqs].sort((a,b)=>b.hosts - a.hosts) : [...reqs];

      let cursor = networkStart>>>0;
      const endOfSpace = (networkStart + blockSize - 1)>>>0;
      const rows = [];

      for(const r of sorted){
        if(!Number.isInteger(r.hosts) || r.hosts<=0){ showErr(msg, `Hosts inv√°lidos en "${r.name}".`); return; }
        const needed = r.hosts + 2; // red+broadcast (CIDR tradicional)
        const hostBits = Math.ceil(Math.log2(needed));
        const subPref = Math.max(0, 32 - hostBits);
        const subBlock = 2**hostBits;
        const aligned = align(cursor, subBlock);
        const netStart = aligned>>>0;
        const netEnd = (aligned + subBlock - 1)>>>0;

        if(netEnd > endOfSpace){
          showErr(msg, `No caben todas las subredes. Fall√≥ en "${r.name}" (${r.hosts} hosts).`); 
          return;
        }

        rows.push({
          name:r.name,
          prefix: subPref,
          mask: prefixToMask(subPref),
          network: numToIp(netStart),
          broadcast: numToIp(netEnd),
          firstHost: subPref===31? numToIp(netStart): numToIp(netStart+1),
          lastHost: subPref===31? numToIp(netEnd): numToIp(netEnd-1),
          usable: subPref>=31 ? (subPref===31?2:1) : (subBlock-2)
        });

        cursor = (netEnd + 1)>>>0;
      }

      out.innerHTML = `
        <table>
          <tr><th>Nombre</th><th>Prefijo</th><th>M√°scara</th><th>Red</th><th>Hosts</th><th>Rango</th><th>Broadcast</th></tr>
          ${rows.map(r=>`
            <tr>
              <td>${escapeHtml(r.name)}</td>
              <td>/${r.prefix}</td>
              <td>${r.mask}</td>
              <td>${r.network}</td>
              <td>${r.usable}</td>
              <td>${r.firstHost} - ${r.lastHost}</td>
              <td>${r.broadcast}</td>
            </tr>`).join("")}
        </table>
      `;
      out.style.display='block';

    }catch(e){
      showErr(msg,'Ocurri√≥ un error al calcular VLSM.');
      console.error(e);
    }
  }

  /* Utilidades IP */
  function ipToNum(parts){
    return ((parts[0]<<24)>>>0) + ((parts[1]<<16)>>>0) + ((parts[2]<<8)>>>0) + (parts[3]>>>0);
  }
  function numToIp(num){
    return `${(num>>>24)&255}.${(num>>>16)&255}.${(num>>>8)&255}.${num&255}`;
  }
  function prefixToMask(p){
    let mask = 0;
    for(let i=0;i<p;i++) mask = (mask<<1) | 1;
    mask = mask << (32-p);
    return numToIp(mask>>>0);
  }
  function align(value, block){
    const m = block - 1;
    return (value + m) & ~m;
  }
</script>
</body>
</html>
